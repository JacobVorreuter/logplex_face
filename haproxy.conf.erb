global
    maxconn 20000
    log 127.0.0.1 local0 info
    stats socket /tmp/haproxy.sok

listen logplexhttp :443
    mode tcp
    log global
    option tcplog
    timeout client 30s
    timeout connect 5s
    timeout server 30s
    balance roundrobin<% @@logplex_instances.each do |ip,weight| %>
    server <%= ip %> <%= ip %>:443 check weight <%= weight %>
<% end %>

listen logplextcp :601
    mode tcp
    log global
    option tcplog
    timeout client 30s
    timeout connect 5s
    timeout server 1d
    balance roundrobin<% @@logplex_instances.each do |ip,weight| %>
    server <%= ip %> <%= ip %>:601 check weight <%= weight %>
<% end %>
