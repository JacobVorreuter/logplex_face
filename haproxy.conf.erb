global
    maxconn 20000
    log 127.0.0.1 local0 info
    stats socket /tmp/haproxy.sock level admin

listen logplexhttp :8000
    mode http
    option httplog
    maxconn 10000
    contimeout 5000 
    clitimeout 50000 
    srvtimeout 50000
    log global
    option tcplog
    timeout client 1d
    timeout connect 5s
    timeout server 1d
    balance url_param srv check_post max_wait 0<% @@logplex_instances.each do |ip,weight| %>
    server <%= ip %> <%= ip %>:8001 check weight <%= weight %><% end %>

listen logplextcp :514
    mode tcp
    log global
    option tcplog
    timeout client 1d
    timeout connect 5s
    timeout server 1d
    balance roundrobin<% @@logplex_instances.each do |ip,weight| %>
    server <%= ip %> <%= ip %>:514 check weight <%= weight %><% end %>

listen logplexsyslog :601
    mode tcp
    log global
    option tcplog
    timeout client 1d
    timeout connect 5s
    timeout server 1d
    balance roundrobin<% @@logplex_instances.each do |ip,weight| %>
    server <%= ip %> <%= ip %>:601 check weight <%= weight %><% end %>
